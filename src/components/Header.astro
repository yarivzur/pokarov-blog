---
import { SITE } from "@/config";

const { pathname } = Astro.url;
const currentPath = pathname.endsWith("/") && pathname !== "/" ? pathname.slice(0, -1) : pathname;

const isActive = (path: string) => {
  if (path === "/") return currentPath === "/";
  return currentPath.startsWith(path);
};

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/blog", label: "Blog" },
  { href: "/about", label: "About" },
];
---

<a
  id="skip-to-content"
  href="#main-content"
  class="absolute -top-full start-16 z-50 bg-background px-3 py-2 text-accent transition-all focus:top-4"
>
  Skip to content
</a>

<header class="app-layout border-b border-border" dir="ltr">
  <nav class="flex items-center justify-between py-4">
    <a href="/" class="text-xl font-semibold text-foreground hover:text-accent" dir="auto">
      {SITE.title}
    </a>

    <div class="flex items-center gap-4">
      <!-- Mobile menu button -->
      <button
        id="menu-btn"
        class="p-2 sm:hidden"
        aria-label="Open Menu"
        aria-expanded="false"
        aria-controls="menu-items"
      >
        <svg id="menu-icon" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg id="close-icon" class="hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <!-- Desktop navigation -->
      <ul class="hidden items-center gap-6 sm:flex">
        {navLinks.map(({ href, label }) => (
          <li>
            <a
              href={href}
              class:list={[
                "py-2 font-medium transition-colors hover:text-accent",
                { "active-nav text-accent": isActive(href) },
              ]}
            >
              {label}
            </a>
          </li>
        ))}
      </ul>

      <!-- Theme toggle -->
      {SITE.lightAndDarkMode && (
        <button
          id="theme-btn"
          class="relative h-8 w-8 p-1"
          title="Toggle theme"
          aria-label="Toggle light/dark theme"
        >
          <!-- Sun icon (light mode) -->
          <svg
            class="absolute left-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 transition-all dark:scale-0 dark:-rotate-90"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
          <!-- Moon icon (dark mode) -->
          <svg
            class="absolute left-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
          </svg>
        </button>
      )}

      <!-- Social links -->
      <div class="hidden items-center gap-2 sm:flex">
        <a href="https://twitter.com/vlvl" target="_blank" rel="noopener noreferrer" class="p-1 hover:text-accent" title="Twitter">
          <span class="sr-only">Follow on Twitter</span>
          <svg viewBox="0 0 16 16" aria-hidden="true" width="24" height="24">
            <path
              fill="currentColor"
              d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"
            />
          </svg>
        </a>
        <a href="https://github.com/yarivzur" target="_blank" rel="noopener noreferrer" class="p-1 hover:text-accent" title="GitHub">
          <span class="sr-only">Go to GitHub profile</span>
          <svg viewBox="0 0 16 16" aria-hidden="true" width="24" height="24">
            <path
              fill="currentColor"
              d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
            />
          </svg>
        </a>
        <a href="/rss.xml" class="p-1 hover:text-accent" title="RSS Feed">
          <span class="sr-only">RSS Feed</span>
          <svg viewBox="0 0 24 24" aria-hidden="true" width="24" height="24" fill="currentColor">
            <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z" />
          </svg>
        </a>
      </div>
    </div>
  </nav>

  <!-- Mobile menu -->
  <ul
    id="menu-items"
    class="hidden border-t border-border py-4 sm:hidden"
  >
    {navLinks.map(({ href, label }) => (
      <li>
        <a
          href={href}
          class:list={[
            "block py-2 font-medium transition-colors hover:text-accent",
            { "active-nav text-accent": isActive(href) },
          ]}
        >
          {label}
        </a>
      </li>
    ))}
  </ul>
</header>

<script>
  function toggleNav() {
    const menuBtn = document.querySelector("#menu-btn");
    const menuItems = document.querySelector("#menu-items");
    const menuIcon = document.querySelector("#menu-icon");
    const closeIcon = document.querySelector("#close-icon");

    if (!menuBtn || !menuItems || !menuIcon || !closeIcon) return;

    menuBtn.addEventListener("click", () => {
      const openMenu = menuBtn.getAttribute("aria-expanded") === "true";

      menuBtn.setAttribute("aria-expanded", openMenu ? "false" : "true");
      menuBtn.setAttribute("aria-label", openMenu ? "Open Menu" : "Close Menu");

      menuItems.classList.toggle("hidden");
      menuIcon.classList.toggle("hidden");
      closeIcon.classList.toggle("hidden");
    });
  }

  toggleNav();
  document.addEventListener("astro:after-swap", toggleNav);
</script>
