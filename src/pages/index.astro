---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import { SITE } from "@/config";
import { getSortedPosts, getFeaturedPosts } from "@/utils/postAdapter";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const featuredPosts = getFeaturedPosts(posts);
const recentPosts = sortedPosts.filter(p => !p.data.featured).slice(0, SITE.postPerIndex);
---

<BaseLayout title={SITE.title} description={SITE.desc} lang="en" dir="ltr">
  <section class="hero py-8 border-b border-border">
    <div class="flex justify-center mb-6">
      <img src="/vlvl.gif" alt="VLVL animation" width="600" height="182" class="rounded-lg bg-white" />
    </div>
    <p class="text-lg text-foreground/80 max-w-2xl leading-relaxed" dir="auto">
      {SITE.desc}
    </p>
  </section>

  {featuredPosts.length > 0 && (
    <section class="featured py-10 border-b border-border">
      <h2 class="text-2xl font-semibold mb-6">Featured Posts</h2>
      <ul class="grid gap-4">
        {featuredPosts.map((post) => (
          <li>
            <a
              href={`/blog/${encodeURIComponent(post.id)}/`}
              class="block rounded-lg border border-border p-4 transition-all hover:border-accent hover:shadow-sm"
            >
              <h3 class="text-lg font-medium text-accent" dir="auto">{post.data.title}</h3>
              <div class="mt-1 text-sm text-foreground/70">
                <FormattedDate date={post.data.pubDatetime ?? post.data.pubDate} />
              </div>
              {post.data.description && (
                <p class="mt-2 text-foreground/80" dir="auto">{post.data.description}</p>
              )}
            </a>
          </li>
        ))}
      </ul>
    </section>
  )}

  <section class="latest py-10">
    <h2 class="text-2xl font-semibold mb-6">Recent Posts</h2>

    <ul class="grid gap-4">
      {recentPosts.map((post) => (
        <li class="flex items-start gap-4 py-2">
          <time
            datetime={post.data.pubDate.toISOString()}
            class="shrink-0 text-sm text-foreground/60 w-24"
          >
            {post.data.pubDate.toLocaleDateString("en-US", {
              year: "numeric",
              month: "short",
              day: "2-digit",
            })}
          </time>
          <div class="flex-1 min-w-0">
            <a
              href={`/blog/${encodeURIComponent(post.id)}/`}
              class="font-medium hover:text-accent transition-colors"
              dir="auto"
            >
              {post.data.title}
            </a>
            {post.data.description && (
              <p class="mt-1 text-sm text-foreground/70 line-clamp-2" dir="auto">
                {post.data.description}
              </p>
            )}
          </div>
        </li>
      ))}
    </ul>

    <p class="mt-8 text-center">
      <a href="/blog" class="text-accent hover:underline">
        View all posts â†’
      </a>
    </p>
  </section>
</BaseLayout>
