---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import { SITE } from "@/config";
import { getSortedPosts, getFeaturedPosts } from "@/utils/postAdapter";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const featuredPosts = getFeaturedPosts(posts);
const recentPosts = sortedPosts.filter(p => !p.data.featured).slice(0, SITE.postPerIndex);
---

<BaseLayout title={SITE.title} description={SITE.desc} lang="en" dir="ltr">
  <section class="hero py-8 border-b border-border">
    <h1 class="text-4xl font-bold mb-4 sm:text-5xl">{SITE.title}</h1>
    <p class="text-lg text-foreground/80 max-w-2xl leading-relaxed" dir="auto">
      {SITE.desc}
    </p>

    <div class="mt-6 flex gap-4 flex-wrap items-center">
      <a
        href="/blog"
        class="inline-block rounded-lg border border-accent bg-accent px-5 py-2.5 font-medium text-background transition-colors hover:bg-accent/90"
      >
        Read the blog
      </a>
      <a
        href="/about"
        class="text-foreground/80 hover:text-accent transition-colors"
      >
        About me
      </a>
      <a
        href="/rss.xml"
        class="text-foreground/80 hover:text-accent transition-colors flex items-center gap-1"
        title="RSS Feed"
      >
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
          <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z" />
        </svg>
        RSS
      </a>
    </div>
  </section>

  {featuredPosts.length > 0 && (
    <section class="featured py-10 border-b border-border">
      <h2 class="text-2xl font-semibold mb-6">Featured Posts</h2>
      <ul class="grid gap-4">
        {featuredPosts.map((post) => (
          <li>
            <a
              href={`/blog/${encodeURIComponent(post.id)}/`}
              class="block rounded-lg border border-border p-4 transition-all hover:border-accent hover:shadow-sm"
            >
              <h3 class="text-lg font-medium text-accent" dir="auto">{post.data.title}</h3>
              <div class="mt-1 text-sm text-foreground/70">
                <FormattedDate date={post.data.pubDatetime ?? post.data.pubDate} />
              </div>
              {post.data.description && (
                <p class="mt-2 text-foreground/80" dir="auto">{post.data.description}</p>
              )}
            </a>
          </li>
        ))}
      </ul>
    </section>
  )}

  <section class="latest py-10">
    <h2 class="text-2xl font-semibold mb-6">Recent Posts</h2>

    <ul class="grid gap-4">
      {recentPosts.map((post) => (
        <li class="flex items-start gap-4 py-2">
          <time
            datetime={post.data.pubDate.toISOString()}
            class="shrink-0 text-sm text-foreground/60 w-24"
          >
            {post.data.pubDate.toLocaleDateString("en-US", {
              year: "numeric",
              month: "short",
              day: "2-digit",
            })}
          </time>
          <div class="flex-1 min-w-0">
            <a
              href={`/blog/${encodeURIComponent(post.id)}/`}
              class="font-medium hover:text-accent transition-colors"
              dir="auto"
            >
              {post.data.title}
            </a>
            {post.data.description && (
              <p class="mt-1 text-sm text-foreground/70 line-clamp-2" dir="auto">
                {post.data.description}
              </p>
            )}
          </div>
        </li>
      ))}
    </ul>

    <p class="mt-8 text-center">
      <a href="/blog" class="text-accent hover:underline">
        View all posts â†’
      </a>
    </p>
  </section>
</BaseLayout>
